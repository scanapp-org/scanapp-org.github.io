<!DOCTYPE html>
<html lang="en-us">
<link rel="icon" sizes="144x144" href="/assets/svg/log_sq-144.jpg">

  <head>
    <link href="https://minhazav.dev" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
        
        Using Flash or Torch with Html5-Qrcode &middot; ScanApp
        
    </title>

    
    <link rel="canonical" href="http://localhost:4000/blog/2022/10/30/using-flash-or-torch-with-html5-qrcode.html">
    

    <link rel="stylesheet" href="https://scanapp.org/assets/css/poole.css">
    <link rel="stylesheet" href="https://scanapp.org/assets/css/syntax.css">
    <link rel="stylesheet" href="https://scanapp.org/assets/css/lanyon.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

    <!-- <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png"> -->
    <!-- <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico"> -->

    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">
</head>

  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
<div class="sidebar-item">
    <p>Free online QR Code and Barcode scanner for web</p>
</div>

<nav class="sidebar-nav">
    <a class="sidebar-nav-item"  href="/">ScanApp - Home</a>

    

    
    
    
        
    
    
    
    
    
    
    
    
    
        
    
    
    
        
    
    
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
    
    
        
    
    

    <!-- <a class="sidebar-nav-item" href="/archive/v.zip">Download</a> -->
    <a class="sidebar-nav-item" href="/blog/">Blog</a>
    <a class="sidebar-nav-item" href="https://github.com/scanapp-org">GitHub project</a>
    <!-- <span class="sidebar-nav-item">Currently v</span> -->
</nav>

<div class="sidebar-item">
    <p>
    &copy; 2023. All rights reserved.
    </p>
</div>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            Blog by <a href="/" title="Home">ScanApp</a>
            <small>Free online QR Code and Barcode scanner for web</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Using Flash or Torch with Html5-Qrcode</h1>
  <span class="post-date">
    30 Oct 2022
    | Authored by <a href="https://minhazav.dev">Minhaz</a>
    
  </span> 
  <p><img src="/assets/images/blog/post3/pexels-gift-habeshaw-3348724.jpg" alt="Screenshot of implementation" /></p>

<p><a href="https://github.com/mebjas/html5-qrcode">html5-qrcode</a> is a fairly used open source library for implementing QR Code or barcode scanner in a web application. It has 400K+ downloads on Github and going around <a href="https://www.npmjs.com/package/html5-qrcode">31K downloads/week on npm</a>.</p>

<blockquote>
  <p>I authored this library in my university days and have been maintaining this project since 2014 (If I remember correctly).</p>

  <p>Enough bragging, coming back to the topic …</p>
</blockquote>

<p>Almost all smartphones today come with camera which is coupled with a flash light. It’s also used as a torch while recording videos. Most QR scanning applications that are available on Android or IOS have support for enabling torch while scanning. This seems useful when scanning a code in low light conditions.</p>

<h2 id="the-feature-request">The feature request</h2>
<p>There was a <a href="https://github.com/mebjas/html5-qrcode/issues/129">feature request</a> on the project Github tracker for adding the same functionality to <a href="https://github.com/mebjas/html5-qrcode">html5-qrcode</a> library.</p>

<blockquote>
  <p>This is very interesting usecase - as it shows the power of web around controlling low level hardware on smartphones.</p>
</blockquote>

<h2 id="support-added-for-html5qrcodescanner">Support added for <code class="highlighter-rouge">Html5QrcodeScanner</code></h2>
<p>Considering the value add for end users, I have added the support for using torch (when supported) to the end to end library (i.e. <a href="https://github.com/mebjas/html5-qrcode/blob/master/src/html5-qrcode-scanner.ts#L135">Html5QrcodeScanner</a>).</p>

<p>The feature is added as yet another button which shows up if</p>
<ol>
  <li>The feature is enabled from config (off by default).</li>
  <li>Torch control is supported on the given browser + device.</li>
</ol>

<p>It looks something like this</p>

<div style="text-align: center">
    <img src="/assets/images/blog/post3/im1.jpeg" alt="Screenshot of implementation" />
</div>

<p>You can try it on <a href="https://scanapp.org">scanapp.org</a>.</p>

<p>So far I have verified it to work on Android devices on browsers like Google Chrome and Samsung’s default internet browser. I have verified it to work on Pixel 6 Pro, Samsung Flip 4 devices and One Plus 10 Pro.</p>

<p>I have also verified it to not work on Chrome or Safari on IOS (on Iphone 13).</p>

<blockquote>
  <p>Why? Likely not supported in the implementation - need to verify!</p>
</blockquote>

<p>The support was added with <a href="https://github.com/mebjas/html5-qrcode/pull/570">PR#570</a>. It’s been published under <code class="highlighter-rouge">version 2.2.6</code>.</p>

<p>To enable the feature with <code class="highlighter-rouge">Html5QrcodeScanner</code> one simply need to set <code class="highlighter-rouge">showTorchButtonIfSupported</code> to <code class="highlighter-rouge">true</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">html5QrcodeScanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Html5QrcodeScanner</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">reader</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="na">fps</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="na">qrbox</span><span class="p">:</span> <span class="p">{</span><span class="na">width</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="na">height</span><span class="p">:</span> <span class="mi">250</span><span class="p">},</span>
        <span class="na">rememberLastUsedCamera</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">aspectRatio</span><span class="p">:</span> <span class="mf">1.7777778</span><span class="p">,</span>
        <span class="na">showTorchButtonIfSupported</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">});</span>

</code></pre></div></div>

<h2 id="how-it-works">How it works?</h2>
<blockquote>
  <p>And how to set flash or torch with <code class="highlighter-rouge">Html5Qrcode</code> library.</p>
</blockquote>

<p>First this you need to check is if <code class="highlighter-rouge">torch</code> is supported. Weather or not <code class="highlighter-rouge">torch</code>
is supported depends on the device, browser as well as the selected camera (often only back camera supports torch).</p>

<p>The idea is to see if <code class="highlighter-rouge">torch</code> is available on <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#instance_properties_of_image_tracks">MediaTrackConstraints</a> of the running video track. When the camera scan is running you can call <a href="https://github.com/mebjas/html5-qrcode/blob/master/src/html5-qrcode.ts#L798">getRunningTrackSettings()</a> to verify if <code class="highlighter-rouge">torch</code> is supported.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** Returns {@code true} if torch is supported. */</span>
<span class="kd">function</span> <span class="nx">isTorchSupported</span><span class="p">(</span><span class="nx">html5Qrcode</span><span class="p">:</span> <span class="nx">Html5Qrcode</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">html5Qrcode</span><span class="p">.</span><span class="nx">getRunningTrackSettings</span><span class="p">();</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">torch</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">settings</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If <code class="highlighter-rouge">torch</code> is indeed supported, the next step is to enable it. You can use <a href="https://github.com/mebjas/html5-qrcode/blob/master/src/html5-qrcode.ts#L826">applyVideoConstraints(..)</a> API to request turning on <code class="highlighter-rouge">torch</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">constraints</span><span class="p">:</span> <span class="nx">MediaTrackConstraints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">torch</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="p">[{</span> <span class="dl">"</span><span class="s2">torch</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}]</span>
<span class="p">};</span>
<span class="k">await</span> <span class="nx">html5Qrcode</span><span class="p">.</span><span class="nx">applyVideoConstraints</span><span class="p">(</span><span class="nx">constraints</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">html5Qrcode</span><span class="p">.</span><span class="nx">getRunningTrackSettings</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">torch</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Torch was indeed enabled, succeess.</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Failure.</span>
    <span class="c1">// Failed to set torch, why?</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In a similar fashion, you can request turning off <code class="highlighter-rouge">torch</code> with the same API.</p>

<h3 id="why-set-twice">Why set twice?</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="p">[{</span> <span class="dl">"</span><span class="s2">torch</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}]</span>
</code></pre></div></div>

<p>For backwards compatibility sake!</p>

<h2 id="browser-and-device-support">Browser and device support</h2>
<p>As shared before this feature seems to be supported on Android devices. I have verified this on at least three Android devices and one IOS device.</p>

<p>Here’s summary:</p>
<ul>
  <li>
    <p>Support verified on several Android devices.</p>
  </li>
  <li>Support verified on following browsers in Android
    <ul>
      <li>Google Chrome</li>
      <li>Samsung Internet Browser</li>
      <li>Opera</li>
      <li>Microsoft Edge</li>
      <li>Brave Browser</li>
      <li>Duck Duck Go Browser</li>
    </ul>
  </li>
  <li>Verified lack of support on following browsers in Android
    <ul>
      <li>Mozilla Firefox</li>
    </ul>
  </li>
  <li>Verified lack of support on Chrome and Safari on IOS (Iphone 13)</li>
</ul>

<p>In case you get a chance to test on more devices using <a href="https://scanapp.org">scanapp.org</a>, please add information in comments. I’ll update this article accordingly.</p>

<h2 id="photo-credits">Photo credits</h2>
<ul>
  <li>Special thanks to photo by <a href="https://www.pexels.com/@lovetosmile/">Gift Habeshaw</a> on <a href="https://www.pexels.com">Pexels</a>.</li>
</ul>

<h2 id="like-this-article">Like this article?</h2>
<p>If you like this article, you can find more of my articles on Medium. If you are already on Medium you can <a href="https://minhazav.medium.com/">follow me</a> and <a href="https://medium.com/membership/@minhazav">subscribe to my articles</a>.</p>

<p>If you are not on Medium, you can <a href="https://medium.com/membership/@minhazav">join with my link</a>. Medium will pay me a peice and that’d be helpful for me to write more such articles. Medium has articles from several awesome authors.</p>

</div>

<!-- TODO(mebjas): Add social badges here -->

<script src="https://utteranc.es/client.js"
  repo="scanapp-org/scanapp-org.github.io"
  issue-term="url"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2022/11/01/using-html5-qrcode-with-only-camera-or-file-options.html">
            Using Html5-qrcode with only Camera or File options
            <small>01 Nov 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2022/01/09/setting-dynamic-qr-box-size-in-html5-qrcode.html">
            Setting dynamic QR box size in Html5-qrcode
            <small>09 Jan 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2021/12/11/open-source-library-for-qr-code-and-barcode-scanning-with-reactjs.html">
            Open source library for QR Code and barcode scanning with ReactJs
            <small>11 Dec 2021</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='https://scanapp.org/assets/js/blog.script.js'></script>
  </body>
</html>