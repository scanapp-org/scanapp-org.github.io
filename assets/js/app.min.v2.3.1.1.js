let TYPE_TEXT="TEXT",TYPE_URL="URL",TYPE_PHONE="PHONE NUMBER",TYPE_WIFI="WIFI",TYPE_UPI="UPI",IS_DEBUG=-1!==location.host.indexOf("127.0.0.1"),QR_RESULT_HEADER_FROM_SCAN="Scanned result",QR_RESULT_HEADER_FROM_HISTORY="Scan result from History",Logger={logScanStart:function(e,t){gtag("event","ScanStart",{event_category:t,event_label:`embed=${e}`})},logScanRestart:function(){gtag("event","ScanStart",{event_category:"Restart",event_label:"NA"}),gtag("event","ScanRestart",{event_category:"Restart",event_label:"NA"})},logScanSuccess:function(e,t){gtag("event","ScanSuccess",{event_category:e,event_label:t}),gtag("event",`ScanSuccess_${e}`,{event_category:"codeType",event_label:"NA"})},logActionCopy:function(){gtag("event","Action-Copy",{})},logActionShare:function(){gtag("event","Action-Share",{}),gtag("event","share",{})},logPaymentAction:function(){gtag("event","Action-Payment",{})},logUrlAction:function(e){gtag("event","Action-Url",{event_callback:function(){e()}})},logAntiEmbedWindowShown:function(){gtag("event","Anti-Embed-Window",{})},logAntiEmbedActionNavigateToScanApp:function(e){gtag("event","Anti-Embed-Action",{event_category:"NavigateToScanapp",event_callback:function(){e()}})},logAntiEmbedActionContinueHere:function(e){gtag("event","Anti-Embed-Action",{event_category:"Continue",event_callback:function(){e()}})},logDisplayMode:function(e){gtag("event",`DisplayMode_${e}`,{})},logA2hsPopupShown:function(){gtag("event","A2hs-popup-shown",{})},logA2hsAddButtonClicked:function(e){gtag("event","A2hs-add-button-clicked",{event_label:!0===e?"true":"false"})},logA2hsCancelButtonClicked:function(e){gtag("event","A2hs-cancel-button-clicked",{event_label:!0===e?"true":"false"})},logA2hsBrowserPromptShown:function(){gtag("event","A2hs-browser-prompt-shown",{})},logA2hsDone:function(){gtag("event","A2hs-done",{})},logA2hsBrowserPromptCancelled:function(){gtag("event","A2hs-browser-prompt-cancelled",{})}};function showBanner(e,t){hideBanners(),selector=".banner.success",textId="banner-success-message",!1===t&&(selector=".banner.error",textId="banner-error-message"),document.getElementById(textId).innerText=e,requestAnimationFrame((()=>{document.querySelector(selector).classList.add("visible")}))}function hideBanners(e){document.querySelectorAll(".banner.visible").forEach((e=>e.classList.remove("visible")))}function shareResult(e,t){const n={title:"Scan result from Scanapp.org",text:e};t==TYPE_URL&&(n.url=e),navigator.share(n).then((function(){showBanner("Shared successfully")})).catch((function(e){showBanner("Sharing cancelled or failed",!1)}))}function createLinkTyeUi(e,t,n){var o=document.createElement("a");o.href=t,n==TYPE_PHONE&&(t=t.toLowerCase().replace("tel:","")),o.innerText=t,e.appendChild(o)}function addKeyValuePairUi(e,t,n){var o=document.createElement("div"),r=document.createElement("span");r.style.fontWeight="bold",r.style.marginRight="10px",r.innerText=t,o.appendChild(r);var a=document.createElement("span");a.innerText=n,o.appendChild(a),e.appendChild(o)}function createWifiTyeUi(e,t){var n=new RegExp(/WIFI:S:(.*);T:(.*);P:(.*);H:(.*);;/g).exec(t);addKeyValuePairUi(e,"SSID",n[1]),addKeyValuePairUi(e,"Type",n[2]),addKeyValuePairUi(e,"Password",n[3])}function createUpiTypeUi(e,t){var n=new URL(t).searchParams,o=n.get("cu");o&&null!=o&&addKeyValuePairUi(e,"Currency",o),addKeyValuePairUi(e,"Payee address",n.get("pa"));var r=n.get("pn");r&&null!=r&&addKeyValuePairUi(e,"Payee Name",r)}function isUrl(e){var t=new RegExp(/^((javascript:[\w-_]+(\([\w-_\s,.]*\))?)|(mailto:([\w\u00C0-\u1FFF\u2C00-\uD7FF-_]+\.)*[\w\u00C0-\u1FFF\u2C00-\uD7FF-_]+@([\w\u00C0-\u1FFF\u2C00-\uD7FF-_]+\.)*[\w\u00C0-\u1FFF\u2C00-\uD7FF-_]+)|(\w+:\/\/(([\w\u00C0-\u1FFF\u2C00-\uD7FF-]+\.)*([\w\u00C0-\u1FFF\u2C00-\uD7FF-]*\.?))(:\d+)?(((\/[^\s#$%^&*?]+)+|\/)(\?[\w\u00C0-\u1FFF\u2C00-\uD7FF:;&%_,.~+=-]+)?)?(#[\w\u00C0-\u1FFF\u2C00-\uD7FF-_]+)?))$/g);if(e.match(t))return!0;var n=new RegExp(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);return!!e.match(n)}function isPhoneNumber(e){var t=new RegExp(/tel:[+]*[0-9]{3,}/g);return e.match(t)}function isWifi(e){var t=new RegExp(/WIFI:S:(.*);T:(.*);P:(.*);H:(.*);;/g);return e.match(t)}function isUpi(e){try{var t=new URL(e);return!(!t||null==t)&&"upi:"===t.protocol}catch(e){return!1}}function detectType(e){return isUrl(e)?TYPE_URL:isPhoneNumber(e)?TYPE_PHONE:isWifi(e)?TYPE_WIFI:isUpi(e)?TYPE_UPI:TYPE_TEXT}function copyToClipboard(e){navigator.clipboard.writeText(e).then((function(){showBanner("Text copied")})).catch((function(e){showBanner("Failed to copy",!1)}))}let HistoryItem=function(e,t,n,o,r){this._decodedText=e,this._decodedResult=t,this._scanType=n,this._codeType=o,this._dateTime=r};HistoryItem.prototype.decodedText=function(){return this._decodedText},HistoryItem.prototype.decodedResult=function(){return this._decodedResult},HistoryItem.prototype.scanType=function(){return this._scanType},HistoryItem.prototype.codeType=function(){return this._codeType},HistoryItem.prototype.dateTime=function(){return this._dateTime};let HistoryManager=function(){this._historyList=[],this.flushToDisk=function(){console.log("todo: saving history to disk")}};HistoryManager.prototype.add=function(e){this._historyList.push(e),this.flushToDisk(),this.render()},HistoryManager.prototype.render=function(e){e.innerHtml="";for(var t=this._historyList.length-1;t>=0;t--){this._historyList[t].render(e)}};let PwaHistoryManager=function(){let e="PWA-DO-NOT-SHOW-RPOMPT";this.doNotShowPwaPrompt=localStorage.getItem(e),this.__setNeverShowPrompt=function(){localStorage.setItem(e,"true")}};PwaHistoryManager.prototype.shouldShowPrompt=function(){return"true"===this.doNotShowPwaPrompt},PwaHistoryManager.prototype.setNeverShowPrompt=function(){this.__setNeverShowPrompt()};let A2HS_SUPPORTED=!1,PwaPromptManager=function(){let e,t=document.getElementById("a2hs-container"),n=document.getElementById("a2hs-add"),o=document.getElementById("a2hs-cancel"),r=document.getElementById("a2hs-add-never"),a=document.getElementById("section-info-more"),i=new PwaHistoryManager,c=0,l=function(){t.style.top="calc(105%)"};window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),e=t,console.log("Deferred installation prompt."),n.addEventListener("click",(function(){let t=r.checked;Logger.logA2hsAddButtonClicked(t),e.prompt(),e.userChoice.then((t=>{Logger.logA2hsBrowserPromptShown(),"accepted"===t.outcome?(console.log("User accepted the A2HS prompt"),Logger.logA2hsDone(),a.innerHTML="Thanks for adding ScanApp to home screen.",setTimeout((function(){l()}),500)):(console.log("User dismissed the A2HS prompt"),Logger.logA2hsBrowserPromptCancelled(),a.innerHTML='Click on "Install" to add ScanApp to home screen.'),e=null}))})),o.addEventListener("click",(function(){let e=r.checked;Logger.logA2hsCancelButtonClicked(e),e&&i.setNeverShowPrompt(),l()}))})),this.__optionallyShowPrompt=function(){if(!A2HS_SUPPORTED)return;if(c>0)return;if(!e)return;if(i.shouldShowPrompt())return;return setTimeout((function(){t.style.top="calc(25%)",++c,Logger.logA2hsPopupShown()}),2e3)}};PwaPromptManager.prototype.optionallyShowPrompt=function(){return this.__optionallyShowPrompt()};let ScanResult=function(e,t,n,o,r){this._decodedText=e,this._decodedResult=t,this._scanType=n,this._codeType=o,this._dateTime=r};function createScanResult(e,t,n){let o=t.result.format.formatName,r=new Date;return new ScanResult(e,t,n,o,r)}ScanResult.prototype.decodedText=function(){return this._decodedText},ScanResult.prototype.decodedResult=function(){return this._decodedResult},ScanResult.prototype.scanType=function(){return this._scanType},ScanResult.prototype.codeType=function(){return this._codeType},ScanResult.prototype.dateTime=function(){return this._dateTime};let QrResultViewer=function(){let e=this,t=document.getElementById("result"),n=document.getElementById("new-scanned-result"),o=document.getElementById("qr-result-viewer-header"),r=document.getElementById("scan-result-code-type"),a=document.getElementById("scan-result-image"),i=document.getElementById("scan-result-text"),c=document.getElementById("scan-result-badge-body"),l=document.getElementById("scan-result-parsed"),s=document.getElementById("action-share"),d=document.getElementById("action-copy"),u=document.getElementById("action-payment"),g=document.getElementById("action-url"),p=document.getElementById("scan-result-close"),m=document.getElementById("no-result-container"),h=document.getElementById("body-footer");a.style.display="none";let y={text:null,type:null};p.addEventListener("click",(function(){hideBanners(),o.style.display="none",n.style.display="none",t.style.border="1px solid #ffffff00",e.onCloseCallback&&(Logger.logScanRestart(),e.onCloseCallback&&e.onCloseCallback()),m.classList.remove("hidden")}));navigator.clipboard?d.addEventListener("click",(function(){hideBanners(),copyToClipboard(i.innerText),Logger.logActionCopy()})):d.style.display="none",u.addEventListener("click",(function(e){hideBanners();var t=decodeURIComponent(y.text);location.href=t,showBanner("Payment action only works if UPI payment apps are installed."),Logger.logPaymentAction()})),g.addEventListener("click",(function(){Logger.logUrlAction((function(){location.href=y.text}))})),navigator.share?s.addEventListener("click",(function(){hideBanners(),shareResult(y.text,y.type),Logger.logActionShare()})):s.style.display="none",this.__render=function(a,s,d){e.onCloseCallback=d,o.innerText=a,m.classList.add("hidden"),r.innerText=s.codeType(),i.innerText=s.decodedText();let p=detectType(s.decodedText());Logger.logScanSuccess(s.scanType(),p),y.text=s.decodedText(),y.type=p,c.innerText=p,l.replaceChildren?l.replaceChildren():l.innerHTML="",l.appendChild(function(e,t){let n=document.createElement("div");return u.style.display=t==TYPE_UPI?"inline-block":"none",g.style.display=t==TYPE_URL?"inline-block":"none",t==TYPE_URL||t==TYPE_PHONE?(createLinkTyeUi(n,e,t),n):t==TYPE_WIFI?(createWifiTyeUi(n,e),n):t==TYPE_UPI?(createUpiTypeUi(n,e),n):(n.innerText=e,n)}(s.decodedText(),p)),h.style.display=d?"block":"none",o.style.display="block",n.style.display="flex",n.style.borderTop="1px solid black",t.style.border="1px solid silver"}};function isEmbeddedInIframe(){return window!==window.parent}function showAntiEmbedWindow(){document.getElementById("iframe-alert").style.display="block",Logger.logAntiEmbedWindowShown(),(adsbygoogle=window.adsbygoogle||[]).push({});var e=document.getElementById("iframe-alert-actions-navigate"),t=document.getElementById("iframe-alert-actions-continue");e.addEventListener("click",(function t(){e.removeEventListener("click",t),e.disabled=!0,Logger.logAntiEmbedActionNavigateToScanApp((function(){window.parent.location.href="https://scanapp.org#referral=anti-embed"}))}));var n=6;t.disabled=!0,function e(){n--,t.innerText=`Continue here (${n})`,n>0?setTimeout(e,1e3):(t.innerText="Continue using here",t.disabled=!1)}(),t.addEventListener("click",(function e(){t.disabled=!0,t.removeEventListener("click",e),Logger.logAntiEmbedActionContinueHere((function(){document.getElementById("iframe-alert").style.display="none"}))}))}function docReady(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}QrResultViewer.prototype.render=function(e,t,n){this.__render(e,t,n)},docReady((function(){var e=isEmbeddedInIframe();e&&showAntiEmbedWindow();let t=new QrResultViewer,n=new PwaPromptManager;let o,r=new Html5QrcodeScanner("reader",{fps:10,qrbox:function(e,t){var n=250,o=e>t?t:e,r=Math.floor(.75*o);return r<n?o<n?{width:o,height:o}:{width:n,height:n}:{width:r,height:r}},useBarCodeDetectorIfSupported:!0,rememberLastUsedCamera:!0,aspectRatio:4/3,showTorchButtonIfSupported:!0}),a=function(){r.getState()===Html5QrcodeScannerState.PAUSED&&r.resume(),o=n.optionallyShowPrompt()};r.render((function(e,n){o&&(clearTimeout(o),o=void 0),console.log(e,n),r.getState()!==Html5QrcodeScannerState.NOT_STARTED&&r.pause(!0);let i="camera";r.getState()===Html5QrcodeScannerState.NOT_STARTED&&(i="file");let c=createScanResult(e,n,i);t.render(QR_RESULT_HEADER_FROM_SCAN,c,a)})),Logger.logScanStart(e,"camera")}));let PWA_ENABLED=!0;PWA_ENABLED&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((()=>{IS_DEBUG&&console.log("Service Worker Registered")})),window.addEventListener("DOMContentLoaded",(()=>{let e="Browser_tab";window.matchMedia("(display-mode: standalone)").matches&&(e="PWA_standalone"),IS_DEBUG?console.log("DISPLAY_MODE_LAUNCH:",e):Logger.logDisplayMode(e)}));